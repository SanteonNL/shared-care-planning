# 1) To use requests in this file, you need to install the REST Client extension in Visual Studio Code
#
# 2) In the settings.json of the REST Client extension, add these environment variables like so:
# "rest-client.environmentVariables": {
#         "$shared": {
#             "path-to-data": "./fsh-generated/resources/"
#         },
#         "local": {
#             "cps-base-url": "http://localhost:8080/fhir/",
#             "cps-access-token": "Basic user:password",
#             "cpc1-base-url": "https://fauxcare.com/fhir/"
#         }
# }
# 
# 3) Switch between environments by clicking on the environment name in the status bar at the bottom right of the window

# Setup FHIR server: add search parameters

###

POST {{cps-base-url}}/SearchParameter
Content-Type: application/fhir+json
Authorization: {{cps-access-token}}

<@ {{path-to-data}}SearchParameter-Task-input-reference.json


###

POST {{cps-base-url}}/SearchParameter
Content-Type: application/fhir+json
Authorization: {{cps-access-token}}

<@ {{path-to-data}}SearchParameter-Task-output-reference.json

###

POST {{cps-base-url}}$reindex

# Test requests for usecase enrollment 

###

GET {{cps-base-url}}CarePlan
    ?category=http://snomed.info/sct%7C135411000146103 \
Content-Type: application/json
Authorization: {{cps-access-token}}

###

POST {{cps-base-url}}
Content-Type: application/fhir+json
Authorization: {{cps-access-token}}

<@ {{path-to-data}}Bundle-cps-bundle-01.json

###

PUT {{cps-base-url}}Subscription/cps-sub-hospitalx 
Content-Type: application/fhir+json
Authorization: {{cps-access-token}}

<@ {{path-to-data}}Subscription-cps-sub-hospitalx.json

###

PUT {{cps-base-url}}Subscription/cps-sub-medicalservicecentre  
Content-Type: application/fhir+json
Authorization: {{cps-access-token}}

<@ {{path-to-data}}Subscription-cps-sub-medicalservicecentre.json

###

PUT {{cps-base-url}}CareTeam/cps-careteam-01/
Content-Type: application/fhir+json
Authorization: {{cps-access-token}}

<@ {{path-to-data}}CareTeam-cps-careteam-01.json

###

PUT {{cps-base-url}}CarePlan/cps-careplan-01/
Content-Type: application/fhir+json
Authorization: {{cps-access-token}}

<@ {{path-to-data}}CarePlan-cps-careplan-01.json


###

POST {{cps-base-url}}
Content-Type: application/fhir+json
Authorization: {{cps-access-token}}

<@ {{path-to-data}}Bundle-cps-bundle-02.json

###

POST {{cps-base-url}}
Content-Type: application/fhir+json
Authorization: {{cps-access-token}}

<@ {{path-to-data}}Bundle-cps-bundle-03.json

###

POST {{cps-base-url}}
Content-Type: application/fhir+json
Authorization: {{cps-access-token}}

<@ {{path-to-data}}Bundle-cps-bundle-07.json

# ###



# Random requests/snippets

GET {{cps-base-url}}ServiceRequest
    ?identifier=2.16.528.1.1007.3.3.21514.ehr.orders|99534756439
Content-Type: application/json
Authorization: {{cps-access-token}}

###

GET {{cps-base-url}}QuestionnaireResponse
    # ?_id=cps-task-02-02
    # &_include=Task:focus
    # &_include=Task:patient
    # &_include=Task:requester
    # &_include=Task:owner
    # &_include=Task:part-of
    # &_include=Task:task-output-valuereference
Content-Type: application/json
Authorization: {{cps-access-token}}

###

PUT {{cps-base-url}}Task/a19
    # ?_id=cps-task-02-02
    # &_include=Task:focus
    # &_include=Task:patient
    # &_include=Task:requester
    # &_include=Task:owner
    # &_include=Task:part-of
    # &_include=Task:task-output-valuereference
Content-Type: application/json
Authorization: {{cps-access-token}}

{
        "resourceType": "Task",
        "id": "a19",
        "meta": {
          "versionId": "2",
          "profile": [
            "http://santeonnl.github.io/shared-care-planning/StructureDefinition/SCPTask"
          ]
        },
        "status": "completed",
        "intent": "order",
        "for": {
          "identifier": {
            "system": "http://fhir.nl/fhir/NamingSystem/bsn",
            "value": "111222333"
          }
        },
        "requester": {
          "identifier": {
            "system": "http://fhir.nl/fhir/NamingSystem/ura",
            "value": "URA-2"
          }
        },
        "owner": {
          "identifier": {
            "system": "http://fhir.nl/fhir/NamingSystem/ura",
            "value": "URA-1"
          }
        },
        "input": [
          {
            "type": {
              "coding": [
                {
                  "code": "Reference",
                  "system": "http://terminology.hl7.org/CodeSystem/task-input-type",
                  "display": "Reference"
                }
              ]
            },
            "valueReference": {
              "identifier": {
                "system": "urn:oid:2.16.840.1.113883.2.4.3.11.60.909.26.34",
                "value": "1"
              }
            }
          }
        ],
        "output": [
          {
            "type": {
              "coding": [
                {
                  "code": "Reference",
                  "system": "http://terminology.hl7.org/CodeSystem/task-input-type",
                  "display": "Reference"
                }
              ]
            },
            "valueReference": {
              "reference": "QuestionnaireResponse/a18"
            }
          }
        ]
      }

###

PUT {{cps-base-url}}QuestionnaireResponse/a18
    # ?_id=cps-task-02-02
    # &_include=Task:focus
    # &_include=Task:patient
    # &_include=Task:requester
    # &_include=Task:owner
    # &_include=Task:part-of
    # &_include=Task:task-output-valuereference
Content-Type: application/json
Authorization: {{cps-access-token}}

{
        "resourceType": "QuestionnaireResponse",
        "id": "a18",
        "status": "completed",
        "questionnaire": "http://decor.nictiz.nl/fhir/Questionnaire/2.16.840.1.113883.2.4.3.11.60.909.26.34-1--20240902134017",
        "item": [
          {
            "linkId": "2.16.840.1.113883.2.4.3.11.60.909.2.2.2208",
            "answer": [
              {
                "valueBoolean": true
              }
            ]
          },
          {
            "linkId": "2.16.840.1.113883.2.4.3.11.60.909.2.2.2209",
            "answer": [
              {
                "valueBoolean": true
              }
            ]
          },
          {
            "linkId": "2.16.840.1.113883.2.4.3.11.60.909.2.2.2210",
            "answer": [
              {
                "valueBoolean": true
              }
            ]
          },
          {
            "linkId": "2.16.840.1.113883.2.4.3.11.60.909.2.2.2211",
            "answer": [
              {
                "valueBoolean": true
              }
            ]
          },
          {
            "linkId": "2.16.840.1.113883.2.4.3.11.60.909.2.2.2212",
            "answer": [
              {
                "valueBoolean": true
              }
            ]
          }
        ]
      }


###

GET {{cps-base-url}}Task
    ?_id=a19
    # &_include=Task:focus
    # &_include=Task:patient
    # &_include=Task:requester
    # &_include=Task:owner
    # &_include=Task:part-of
    &_include=Task:input-reference
    &_include=Task:output-reference
Content-Type: application/json
Authorization: {{cps-access-token}}

###
GET {{cps-base-url}}Task
    ?output-reference=QuestionnaireResponse/a18
    # &_include=Task:focus
    # &_include=Task:patient
    # &_include=Task:requester
    # &_include=Task:owner
    # &_include=Task:part-of
    # &_include=Task:output-valuereference-reference
Content-Type: application/json
Authorization: {{cps-access-token}}

###
GET {{cps-base-url}}SearchParameter

###
GET {{cps-base-url}}QuestionnaireResponse/a18

###
DELETE {{cps-base-url}}SearchParameter/2

###
DELETE {{cps-base-url}}Task/31 HTTP/1.1

###
DELETE {{cps-base-url}}ServiceRequest/32 HTTP/1.1

###
DELETE {{cps-base-url}}ServiceRequest/2.16.528.1.1007.3.3.21514.ehr.orders-99534756439 HTTP/1.1

###
DELETE {{cps-base-url}}Patient?identifier=http://fhir.nl/fhir/NamingSystem/bsn|991188226

###

curl --request POST \
  --url http://localhost:8080/fhir//SearchParameter \
  --header 'content-type: application/fhir+json' \
  --data '{"resourceType": "SearchParameter","id": "Task-output-valuereference","url": "http://santeonnl.github.io/shared-care-planning/cps-searchparameter-task-output-valuereference.json","name": "output-valuereference","status": "active","description": "Search Tasks by output references and include outputs when searching Tasks","code": "output-valuereference","base": ["Task"],"type": "reference","expression": "Task.output.valueReference","xpathUsage": "normal","xpath": "f:Task/f:output/f:valueReference"}'

###
curl --request PUT \
  --url http://localhost:8080/fhir/Task/a19 \
  --header 'content-type: application/json' \
  --data '{"resourceType": "Task","id": "a19","meta": {"versionId": "2","profile": ["http://santeonnl.github.io/shared-care-planning/StructureDefinition/SCPTask"]},"status": "completed","intent": "order","for": {"identifier": {"system": "http://fhir.nl/fhir/NamingSystem/bsn","value": "111222333"}},"requester": {"identifier": {"system": "http://fhir.nl/fhir/NamingSystem/ura","value": "URA-2"}},"owner": {"identifier": {"system": "http://fhir.nl/fhir/NamingSystem/ura","value": "URA-1"}},"input": [{"type": {"coding": [{"code": "Reference","system": "http://terminology.hl7.org/CodeSystem/task-input-type","display": "Reference"}]},"valueReference": {"identifier": {"system": "urn:oid:2.16.840.1.113883.2.4.3.11.60.909.26.34","value": "1"}}}],"output": [{"type": {"coding": [{"code": "Reference","system": "http://terminology.hl7.org/CodeSystem/task-input-type","display": "Reference"}]},"valueReference": {"reference": "QuestionnaireResponse/a18"}}]}'
###
curl --request PUT \
  --url http://localhost:8080/fhir/QuestionnaireResponse/a18 \
  --header 'content-type: application/json' \
  --data '{"resourceType": "QuestionnaireResponse","id": "a18","status": "completed","questionnaire": "http://decor.nictiz.nl/fhir/Questionnaire/2.16.840.1.113883.2.4.3.11.60.909.26.34-1--20240902134017","item": [{"linkId": "2.16.840.1.113883.2.4.3.11.60.909.2.2.2208","answer": [{"valueBoolean": true}]},{"linkId": "2.16.840.1.113883.2.4.3.11.60.909.2.2.2209","answer": [{"valueBoolean": true}]},{"linkId": "2.16.840.1.113883.2.4.3.11.60.909.2.2.2210","answer": [{"valueBoolean": true}]},{"linkId": "2.16.840.1.113883.2.4.3.11.60.909.2.2.2211","answer": [{"valueBoolean": true}]},{"linkId": "2.16.840.1.113883.2.4.3.11.60.909.2.2.2212","answer": [{"valueBoolean": true}]}]}'
###
curl --request GET \
  --url 'http://localhost:8080/fhir/Task?output-valuereference=QuestionnaireResponse%2Fa18' \
  --header 'content-type: application/json' 

###
curl --request GET \
  --url 'http://localhost:8080/fhir/Task?output-valuereference-reference=QuestionnaireResponse%2Fa18' \
  --header 'content-type: application/json' 


###
POST {{cps-base-url}}
Content-Type: application/fhir+json
Authorization: {{cps-access-token}}

{
  "resourceType": "Bundle",
  "type": "transaction",
  "entry": [
    {
      "resource": {
        "resourceType": "Task",
        "meta": {
          "version": "1",
          "profile": [
            "http://santeonnl.github.io/shared-care-planning/StructureDefinition/SCPTask"
          ]
        },
        "status": "requested",
        "intent": "order",
        "code": {
          "coding": [
            {
              "system": "http://hl7.org/fhir/CodeSystem/task-code",
              "code": "fullfill"
            }
          ]
        },
        "focus": {
          "reference": "urn:uuid:ewSPPEVLOvrbP5lOB3RcJxTmoPGhqwW2sXtpBg59rOY43"
        },
        "for": {
          "reference": "urn:uuid:eMHenDEmb0pPKgx9fCqgriUjNuuYji1wdA33dx8IfrCE3"
        },
        "requester": {
          "identifier": {
            "system": "http://fhir.nl/fhir/NamingSystem/ura",
            "value": "21514"
          }
        },
        "owner": {
          "identifier": {
            "system": "http://fhir.nl/fhir/NamingSystem/ura",
            "value": "86446"
          }
        },
        "reasonCode": {
          "coding": null
        }
      },
      "request": {
        "url": "Task",
        "method": "POST"
      }
    },
    {
      "fullUrl": "urn:uuid:ewSPPEVLOvrbP5lOB3RcJxTmoPGhqwW2sXtpBg59rOY43",
      "resource": {
        "resourceType": "ServiceRequest",
        "identifier": [
          {
            "use": "usual",
            "type": {
              "coding": [
                {
                  "system": "http://terminology.hl7.org/CodeSystem/v2-0203",
                  "code": "PLAC",
                  "display": "Placer Identifier"
                }
              ],
              "text": "Placer Identifier"
            },
            "system": "urn:oid:1.2.840.114350.1.13.487.3.7.2.798268",
            "value": "55242485"
          }
        ],
        "status": "active",
        "intent": "original-order",
        "category": [
          {
            "coding": [
              {
                "system": "http://snomed.info/sct",
                "code": "371883000",
                "display": "poliklinische verrichting (verrichting)"
              },
              {
                "system": "urn:oid:1.2.840.114350.1.13.487.3.7.10.798268.30",
                "code": "610000",
                "display": "Afspraak"
              }
            ],
            "text": "Afspraak"
          }
        ],
        "priority": "routine",
        "code": {
          "coding": [
            {
              "system": "urn:oid:1.2.840.114350.1.13.487.3.7.2.696580",
              "code": "230077",
              "display": "TM CAR HARTFALEN AANMELDING THUISMONITORING"
            }
          ],
          "text": "CAR hartfalen aanmelding thuismonitoring"
        },
        "quantityQuantity": {
          "value": 1
        },
        "subject": {
          "reference": "urn:uuid:eMHenDEmb0pPKgx9fCqgriUjNuuYji1wdA33dx8IfrCE3",
          "display": "Xxx-Aansluittest, Betsy"
        },
        "encounter": {
          "reference": "https://sintantonius.nl/Encounter/eeBQ-NOnhJ4uHk2OnpE639w3",
          "identifier": {
            "use": "usual",
            "system": "urn:oid:1.2.840.114350.1.13.487.3.7.3.698084.8",
            "value": "72255058"
          },
          "display": "Alleen orders"
        },
        "occurrencePeriod": {
          "start": "2024-11-06T23:00:00Z"
        },
        "authoredOn": "2024-11-07T14:40:13Z",
        "requester": {
          "reference": "https://sintantonius.nl/Practitioner/eGWu9OiNVI9ZmCwlfakGoYPT1wnf.ZXP-.xa1aC5Rq.w3",
          "type": "Practitioner",
          "display": "J. Abarbanel"
        },
        "note": [
          {
            "text": "- Optitratie: Ja\r\n- Na opname: Ja\r\n- Emailadres en telefoonnummer zijn juist in EPIC genoteerd: Ja\r\n- PatiÃ«nt is in staat de app te bedienen: Ja\r\n- Is er een taalbarriere: Ja\r\n- PatiÃ«nt heeft een bloeddrukmeter: Ja \r\n- Ontslagdatum: 21-11-2024"
          }
        ]
      },
      "request": {
        "url": "ServiceRequest?identifier=urn:oid:1.2.840.114350.1.13.487.3.7.2.798268|55242485",
        "method": "PUT"
      }
    },
    {
      "fullUrl": "urn:uuid:eMHenDEmb0pPKgx9fCqgriUjNuuYji1wdA33dx8IfrCE3",
      "resource": {
        "resourceType": "Patient",
        "extension": [
          {
            "valueCodeableConcept": {
              "coding": [
                {
                  "system": "urn:oid:1.2.840.114350.1.13.487.3.7.10.698084.130.657370.310560001",
                  "code": "female",
                  "display": "female"
                }
              ]
            },
            "url": "http://open.epic.com/FHIR/StructureDefinition/extension/legal-sex"
          },
          {
            "valueCodeableConcept": {
              "coding": [
                {
                  "system": "urn:oid:1.2.840.114350.1.13.487.3.7.10.698084.130.657370.310560001",
                  "code": "female",
                  "display": "female"
                }
              ]
            },
            "url": "http://open.epic.com/FHIR/StructureDefinition/extension/sex-for-clinical-use"
          },
          {
            "valueCode": "248152002",
            "url": "http://hl7.org/fhir/us/core/StructureDefinition/us-core-sex"
          }
        ],
        "identifier": [
          {
            "use": "usual",
            "type": {
              "text": "CEID"
            },
            "system": "urn:oid:1.2.840.114350.1.13.487.3.7.3.688884.100",
            "value": "SNZPP268ZLXCSFL"
          },
          {
            "use": "usual",
            "type": {
              "text": "EPIC"
            },
            "system": "urn:oid:1.2.840.114350.1.13.487.3.7.5.737384.0",
            "value": "E1932124"
          },
          {
            "use": "usual",
            "type": {
              "text": "EXTERNAL"
            },
            "system": "urn:oid:1.2.840.114350.1.13.487.3.7.2.698084",
            "value": "Z1933001"
          },
          {
            "use": "usual",
            "type": {
              "text": "FHIR"
            },
            "system": "http://open.epic.com/FHIR/StructureDefinition/patient-dstu2-fhir-id",
            "value": "TjQOZCiFHN-723DRGAEdWzTUgt2qZfBEA4E0b3IFYDU0B"
          },
          {
            "use": "usual",
            "type": {
              "text": "FHIR STU3"
            },
            "system": "http://open.epic.com/FHIR/StructureDefinition/patient-fhir-id",
            "value": "eMHenDEmb0pPKgx9fCqgriUjNuuYji1wdA33dx8IfrCE3"
          },
          {
            "use": "usual",
            "type": {
              "text": "INTERNAL"
            },
            "system": "urn:oid:1.2.840.114350.1.13.487.3.7.2.698084",
            "value": "  Z1933001"
          },
          {
            "use": "usual",
            "type": {
              "text": "LOCAL"
            },
            "system": "urn:oid:2.16.528.1.1007.3.3.21514.2.2.4.1",
            "value": "3003156"
          },
          {
            "use": "usual",
            "type": {
              "text": "WPRINTERNAL"
            },
            "system": "urn:oid:1.2.840.114350.1.13.487.3.7.2.878082",
            "value": "124419"
          },
          {
            "use": "usual",
            "system": "http://fhir.nl/fhir/NamingSystem/bsn",
            "value": "999990019"
          }
        ],
        "active": true,
        "name": [
          {
            "extension": [
              {
                "valueCode": "NL3",
                "url": "http://hl7.org/fhir/StructureDefinition/humanname-assembly-order"
              }
            ],
            "use": "official",
            "text": "B. Xxx-Aansluittest",
            "family": "Xxx-Aansluittest",
            "given": [
              "B."
            ],
            "_family": {
              "extension": [
                {
                  "valueString": "Aansluittest",
                  "url": "http://hl7.org/fhir/StructureDefinition/humanname-own-name"
                },
                {
                  "valueString": "Xxx",
                  "url": "http://hl7.org/fhir/StructureDefinition/humanname-partner-name"
                }
              ]
            },
            "_given": [
              {
                "extension": [
                  {
                    "valueCode": "IN",
                    "url": "http://hl7.org/fhir/StructureDefinition/iso21090-EN-qualifier"
                  }
                ]
              }
            ]
          },
          {
            "extension": [
              {
                "valueCode": "NL3",
                "url": "http://hl7.org/fhir/StructureDefinition/humanname-assembly-order"
              }
            ],
            "use": "usual",
            "text": "Betsy Xxx-Aansluittest",
            "family": "Xxx-Aansluittest",
            "given": [
              "B."
            ],
            "_family": {
              "extension": [
                {
                  "valueString": "Aansluittest",
                  "url": "http://hl7.org/fhir/StructureDefinition/humanname-own-name"
                },
                {
                  "valueString": "Xxx",
                  "url": "http://hl7.org/fhir/StructureDefinition/humanname-partner-name"
                }
              ]
            },
            "_given": [
              {
                "extension": [
                  {
                    "valueCode": "IN",
                    "url": "http://hl7.org/fhir/StructureDefinition/iso21090-EN-qualifier"
                  }
                ]
              }
            ]
          },
          {
            "extension": [
              {
                "valueCode": "NL4",
                "url": "http://hl7.org/fhir/StructureDefinition/humanname-assembly-order"
              }
            ],
            "use": "old",
            "text": "XXXAANSLUITTEST,B.",
            "family": "Xxxaansluittest",
            "given": [
              "B."
            ],
            "_family": {
              "extension": [
                {
                  "valueString": "Xxxaansluittest",
                  "url": "http://hl7.org/fhir/StructureDefinition/humanname-own-name"
                }
              ]
            }
          },
          {
            "extension": [
              {
                "valueCode": "NL4",
                "url": "http://hl7.org/fhir/StructureDefinition/humanname-assembly-order"
              }
            ],
            "use": "old",
            "text": "XXX-AANSLUITTEST,B.",
            "family": "Xxx-Aansluittest",
            "given": [
              "B."
            ],
            "_family": {
              "extension": [
                {
                  "valueString": "Xxx-Aansluittest",
                  "url": "http://hl7.org/fhir/StructureDefinition/humanname-own-name"
                }
              ]
            }
          }
        ],
        "gender": "female",
        "birthDate": "1950-02-02",
        "deceasedBoolean": false,
        "address": [
          {
            "use": "home",
            "city": "Enschede",
            "postalCode": "9999 XY",
            "country": "NLD",
            "_line": [
              {
                "extension": [
                  {
                    "valueString": "Knolweg",
                    "url": "http://hl7.org/fhir/StructureDefinition/iso21090-ADXP-streetName"
                  },
                  {
                    "valueString": "1001",
                    "url": "http://hl7.org/fhir/StructureDefinition/iso21090-ADXP-houseNumber"
                  }
                ]
              }
            ]
          },
          {
            "use": "old",
            "city": "Enschede",
            "postalCode": "9999 XX",
            "country": "NLD",
            "_line": [
              {
                "extension": [
                  {
                    "valueString": "Knolweg",
                    "url": "http://hl7.org/fhir/StructureDefinition/iso21090-ADXP-streetName"
                  },
                  {
                    "valueString": "1001",
                    "url": "http://hl7.org/fhir/StructureDefinition/iso21090-ADXP-houseNumber"
                  }
                ]
              }
            ]
          },
          {
            "use": "old",
            "city": "Enschede",
            "postalCode": "9999 XY",
            "country": "NLD",
            "_line": [
              {
                "extension": [
                  {
                    "valueString": "Knolweg",
                    "url": "http://hl7.org/fhir/StructureDefinition/iso21090-ADXP-streetName"
                  },
                  {
                    "valueString": "1001",
                    "url": "http://hl7.org/fhir/StructureDefinition/iso21090-ADXP-houseNumber"
                  }
                ]
              }
            ]
          }
        ],
        "communication": [
          {
            "language": {
              "coding": [
                {
                  "system": "urn:ietf:bcp:47",
                  "code": "nl",
                  "display": "Nederlands"
                }
              ],
              "text": "Nederlands"
            },
            "preferred": true
          }
        ],
        "generalPractitioner": [
          {
            "reference": "https://sintantonius.nl/Practitioner/eGWu9OiNVI9ZmCwlfakGoYPT1wnf.ZXP-.xa1aC5Rq.w3",
            "type": "Practitioner",
            "display": "J. Abarbanel"
          }
        ],
        "managingOrganization": {
          "reference": "https://sintantonius.nl/Organization/eFJTqsfY2f-4SZhzlJ..Ezw3",
          "display": "St Antonius"
        }
      },
      "request": {
        "url": "Patient?identifier=http://fhir.nl/fhir/NamingSystem/bsn|999990019",
        "method": "PUT"
      }
    }
  ]
}
